# 后端测试指南

本项目使用 `pytest` 框架进行后端自动化测试。

## 测试策略

我们的测试策略遵循分层和隔离的原则：

1.  **单元/集成测试**: 测试主要集中在 API 路由层。我们验证每个端点是否能正确处理有效的请求、拒绝无效的请求、执行正确的业务逻辑，并返回符合预期的响应。
2.  **数据库隔离**: 所有测试都在一个独立的 **SQLite 内存数据库** 中运行。每个测试函数开始时，数据库表会被创建；测试结束后，所有表都会被销毁。这确保了测试之间的完全隔离，避免了数据污染。
3.  **依赖覆盖**: 我们使用 FastAPI 的 `dependency_overrides` 机制，在测试期间将生产环境的数据库会话 (`get_session`) 替换为连接到内存数据库的测试会话。
4.  **外部服务模拟 (Mocking)**: 对于需要调用外部 API（如 Google Gemini AI）的接口，我们使用 `pytest-mock` 库来模拟这些外部调用。这使得测试快速、稳定，并且不依赖于网络或产生实际费用。

## 如何运行测试

1.  **安装依赖**:
    确保你已经安装了所有生产和测试依赖。

    ```bash
    pip install -r backend/requirements.txt
